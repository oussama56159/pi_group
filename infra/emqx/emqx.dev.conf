# ============================================================================
# AeroCommand EMQX Configuration (Development)
# - SSL/WSS disabled to avoid cert requirements locally.
# ============================================================================

node {
    name = "emqx@127.0.0.1"
    cookie = "aerocommand_emqx_secret_cookie"
    data_dir = "/opt/emqx/data"
}

# ── Listeners ──
listeners.tcp.default {
    bind = "0.0.0.0:1883"
    max_connections = 10000
    proxy_protocol = false
}

listeners.ws.default {
    bind = "0.0.0.0:8083"
    max_connections = 5000
    websocket.mqtt_path = "/mqtt"
}

# ── Authentication / Authorization (dev: allow anonymous) ──
authentication = []

authorization {
    no_match = allow
    deny_action = ignore
    sources = []
}

# ── MQTT Protocol Settings ──
mqtt {
    max_packet_size = 1MB
    max_clientid_len = 256
    max_topic_levels = 10
    max_qos_allowed = 2
    max_topic_alias = 65535
    retain_available = true
    wildcard_subscription = true
    shared_subscription = true
    keepalive_multiplier = 1.5
}

# ── Session / Queue ──
session {
    max_subscriptions = 100
    upgrade_qos = false
    max_inflight = 100
    retry_interval = 30s
    max_awaiting_rel = 100
    await_rel_timeout = 300s
}

# ── Rate Limiting ──
limiter {
    max_conn_rate = "500/s"
    messages_rate = "1000/s"
    bytes_rate = "10MB/s"
}

# ── Dashboard ──
dashboard {
    listeners.http {
        bind = "0.0.0.0:18083"
    }
    default_username = "admin"
    default_password = "aerocommand_emqx_admin"
}

# ── Logging ──
log {
    console {
        enable = true
        level = warning
    }
    file {
        enable = true
        level = info
        path = "/opt/emqx/log/emqx.log"
        rotation_count = 10
        rotation_size = 50MB
    }
}
